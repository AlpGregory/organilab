{% extends 'base.html' %}
{% load i18n laboratory static %}
{% load gtsettings %}
{% load urlname_tags %}
{% load organilab_tags %}
{% block pre_head %}
    {% define_true  "use_datatables" %}
    {% define_urlname_action 'procedure_list' %}
    {% define_urlname_action 'procedure_update' %}
    {% define_urlname_action 'delete_procedure' %}
    {% define_urlname_action 'add_steps_wrapper' %}
    {% define_urlname_action 'get_procedure' %}
    {% define_urlname_action 'procedure_create' %}
    {% define_urlname_action 'procedure_detail' %}
    {% define_urlname_action 'generate_reservation' %}
{% endblock %}
{% block title %}{% trans 'Procedure' %}{% endblock %}
{% block content %}
    <h2><a href="{% url 'academic:procedure_create' org_pk=org_pk lab_pk=laboratory %}" class="btn btn-primary">
        <i class="fa fa-plus"></i> {% trans 'Create New Procedure' %}</a></h2>

    <table  id="datatable" class="table table-bordered table-hover">
        <thead>
        <tr>
        <th width="30%">{% trans 'Title' %}</th>
        <th width="50%">{% trans 'Description' %}</th>
        <th width="20%">{% trans 'Actions' %}</th>
        </tr>
        </thead>
        <tbody>
            {% for procedure in object_list %}
                <tr>
                    <td>{{procedure.title}}</td>
                    <td>{{ procedure.description | safe }}</td>
                    <td>
                        <div class="d-flex justify-content-center flex-column p-2">
                        <a class="btn btn-info btn-block" href="{% url 'academic:procedure_detail' pk=procedure.id lab_pk=laboratory org_pk=org_pk %}">
                            <i class="fa fa-eye"></i> {{procedure.procedurestep_set.all.count}} {% trans 'Step detail' %}</a>
                        <a class="btn btn-success btn-block" href="{% url 'academic:add_steps_wrapper' pk=procedure.id lab_pk=laboratory org_pk=org_pk %}">
                            <i class="fa fa-plus"></i> {% trans 'New Step' %}</a>
                        <a href="{% url 'academic:procedure_update' pk=procedure.id lab_pk=laboratory org_pk=org_pk %}" class="btn btn-primary btn-block">
                           <i class="fa fa-edit"></i> {% trans 'Edit' %}</a>
                        <a class="btn btn-danger btn-block" onclick="delete_procedure({{procedure.pk}},'{{procedure.title}}')">
                            <i class="fa fa-trash"></i> {% trans 'Remove' %}</a>
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block js %}
	{{block.super}}
	<script>
	    document.remove_procedure="{% url 'academic:delete_procedure' lab_pk=laboratory org_pk=org_pk %}"
		var table=$("#datatable").DataTable();
		table.order( [ 0, 'desc' ] ).draw();

	</script>
    <script src="{% static 'js/procedures.js' %}?v={% get_organilab_version %}"></script>
{% endblock %}